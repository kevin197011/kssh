#!/usr/bin/env ruby
# frozen_string_literal: true

# Copyright (c) 2022 kk
#
# This software is released under the MIT License.
# https://opensource.org/licenses/MIT

require_relative '../config/config'
require 'terminal-table'

opts = ARGV

# default key path
default_key_path = '~/.ssh'

# config host list
kssh_hosts = @kssh_hosts

unless opts.length >= 1
  print "Usage: \n  kssh [list|host[number]]!"
  exit(true)
end

if opts.first == 'list'
  # puts 'Hosts List:'
  rows = []
  kssh_hosts.each_with_index do |value, index|
    index += 1
    rows << [index.to_s, value[:name], value[:ip]]
    # puts "  [#{index}]#{value[:name]} => #{value[:ip]}"
  end
  tables = Terminal::Table.new(title: 'Kssh Tools', headings: ['No.', 'Hostname', 'Address'], rows:)
  puts tables

  exit(true)
end

num = opts.first
val = kssh_hosts[num.to_i - 1]
system("ssh -i #{default_key_path}/#{val[:passwdOrKey]} #{val[:username]}@#{val[:ip]}")
